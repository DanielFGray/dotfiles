#!/usr/bin/env bash

# if [[ -e "${HOME}/.bash_utils" ]]; then
#   source "${HOME}/.bash_utils"
# else
#   printf '\e[31m~/.bash_utils does not exist\e[0m\n' >&2
#   exit 1
# fi

declare esc=$'\033'
declare c_reset="${esc}[0m"
declare c_red="${esc}[31m"
declare c_green="${esc}[32m"
declare c_blue="${esc}[34m"

in_term() {
  [[ -t 0 || -p /dev/stdin ]]
}

is_running() {
  pgrep "$1" &> /dev/null
}

info() {
  if in_term; then
    printf "${c_blue}%s${c_reset}\n" "$*" >&2
  else
    zenity --info --text="$*"
  fi
}

err() {
  if in_term; then
    printf "${c_red}%s${c_reset}\n" "$*" >&2
  else
    zenity --error --text="$*"
  fi
}

die() {
  [[ -n "$1" ]] && err "$1"
  exit 1
}

has() {
  local verbose=false
  if [[ $1 == '-v' ]]; then
    verbose=true
    shift
  fi
  for c in "$@"; do c="${c%% *}"
    if ! command -v "$c" &> /dev/null; then
      [[ "$verbose" == true ]] && err "$c not found"
      return 1
    fi
  done
}

ask() {
  if in_term; then
    read -r -n1 -p "$* " ans
    printf '\n'
    [[ ${ans^} == Y* ]]
  else
    zenity --question --text="$*"
  fi
}

prompt() {
  local opts=() one
  if [[ "$1" == '-1' ]]; then
    opts+=( '-n1' )
    one=1
    shift
  fi
  if [[ "$1" == '-s' ]]; then
    opts+=( '-s' )
    shift
  fi
  read -e -r ${opts[*]} -p "$* " ans
  if [[ $one == '1' ]]; then
    printf '\n'
    [[ ${ans,} == y ]]
  else
    printf '%s\n' "$ans"
  fi
}

select-from() {
  local cmd='command -v'
  for a in "$@"; do
    case "$a" in
      -c)
        cmd="$2"
        shift 2
        ;;
    esac
  done
  for c in "$@"; do
    if $cmd "${c%% *}" &> /dev/null; then
      echo "$c"
      return 0
    fi
  done
  return 1
}
