#!/usr/bin/env bash

echoerr() { echo "$@" 1>&2; }

if ! command -v "mpc" &> /dev/null; then
	echoerr 'command not found: mpc'
	exit 1
fi

if [[ ! -x $HOME/.fzf/fzf ]]; then
	echoerr "command not found: $HOME/.fzf/fzf"
	exit 1
fi

mapfile -t songs < <(mpc listall | sort -r | "$HOME/.fzf/fzf" --reverse -m -e +s)
if (( ${#songs[@]} > 0 )); then
	printf '%s\n' "${songs[@]}" | mpc -q add
	index=$(mpc playlist | wc -l)
	if (( ${#songs[@]} > 1 )); then
		index=$(( $index - ${#songs[@]} + 1))
	fi
	mpc -q play "$index"
fi
