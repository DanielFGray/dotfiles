#!/usr/bin/env bash
declare available=0
declare total=0

has() {
  command -v "$1" &> /dev/null
}

unitConversion() {
  local num units pointer
  num="$1"
  units=( K M G T )
  pointer=0
  while (( $(bc <<< "$num > 1024") && pointer < "${#units[@]}" )); do
    num=$(bc <<< "scale=1; $num/1024") && (( pointer++ ))
  done
  [[ $num == *.0 ]] && num="${num%%.*}"
  printf '%s%s' "$num" "${units[$pointer]}"
}

getSpaceAvailable() {
  local used _
  if has quota && quota &> /dev/null; then
    read -r _ used total _ < <(quota -w | tail -n1)
    available=$(( total - used ))
  else
    read -r used total < <(df --total --output=used,size | tail -n1)
    available=$(( total - used ))
  fi
}

getSpaceAvailable

printf "You have %s remaining of %s\n" "$(unitConversion "$available")" "$(unitConversion "$total")"
