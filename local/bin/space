#!/usr/bin/env bash
declare available=0
declare total=0

has() {
  command -v "$1" &> /dev/null
}

unitConversion() {
  awk 'function unitConversion(num) {
    split("K M G T", unit);
    pointer=1;
    while(num>=1025 && pointer < length(unit)) {
      num = num/1024; pointer++;
    }
    return sprintf("%0.1f%s", num, unit[pointer]);
  }
  { print unitConversion($0); }' <<< "$1"
}

getSpaceAvailable() {
  local used _
  if has quota && quota &> /dev/null; then
    read -r _ used total _ < <(quota -w | tail -n1)
    available=$(( total - used ))
  else
    read -r used total < <(df --total --output=used,size | tail -n1)
    available=$(( total - used ))
  fi
}

getSpaceAvailable

if [[ $1 == -s ]]; then
  printf "%s/%s\n" "$(unitConversion "$available")" "$(unitConversion "$total")"
else
  printf "You have %s remaining of %s\n" "$(unitConversion "$available")" "$(unitConversion "$total")"
fi
