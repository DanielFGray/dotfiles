#!/usr/bin/env bash

lookup() {
  read -e -p 'enter street name: ' streetname
  checkroad "$streetname"
  lookup
}

checkroad() {
  mapfile -t streets < <(command curl -s 'http://206.74.144.9/streetfinder/StreetNames.aspx' -d "cmd=streetnamesex&county=2&street=${1}" | awk 'BEGIN {RS="|"} {print}')
  if (( ${#streets[@]} > 0 )); then
    for i in "${streets[@]}"; do
      trimmed=$(cut -d'(' -f1 <<< "$i" | sed 's/\s*$//')
      # printf '%s: ' "$trimmed"
      echo "$trimmed"
      road=$(command curl -s 'http://206.74.144.9/streetfinder/StreetNames.aspx' -d "cmd=streetnames&county=2&street=${trimmed}")
      if grep 'multiple road names' <<< "$road" &> /dev/null ; then
        multiples=$(command curl -s 'http://206.74.144.9/streetfinder/StreetNames.aspx' -d "cmd=streetnamesex&county=2&street=${trimmed}" | awk 'BEGIN {RS="|"} {print}' | grep "${trimmed}")
        echo "$multiples"
      else
        printf "$road"
        echo
      fi
    done
  else
    echo 'no street found'
  fi
}
lookup
